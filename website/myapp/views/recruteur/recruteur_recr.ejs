<html>
    <head>
        <meta charset="utf-8">
        <title>Recruter</title>
        <link rel="stylesheet" href="/stylesheets/main.css">
    </head>
    <body>
        <div id="page">
            <div id="top_bar">
                <div id="home_button">
                    <a href="/recruteur/recruteur_main"><button id="menu">Menu</button></a>
                </div>
                <div id="recr">
                    <a href="/recruteur/recruteur_menu_offres"><button>Gérer les Offres/Fiches de Poste</button></a>    
                </div>
                <div id="account">
                    <a href="/recruteur/recruteur_account"><button id="account">Mon compte</button></a>
                </div>
            </div>
    
            <div id="container">
                <div id="offres">
                    <div id="label">
                        <p>Liste des offres</p>
                    </div>
                    <% offres.forEach((offre)=> { %>
                    <div id="off">
                        <div id="off_img">
                            <img src="/uploads/<%=offre.logo%>" alt="Logo de l'entreprise">
                        </div>
                        <div class="entreprise">
                            <h1><%= offre.nom%></h1>
                                <p>Siren : <%= offre.siren%></p>
                                <p>Numéro de fiche de poste : <%= offre.id_fiche %></p>
                                <p>Numéro de l'offre : <%= offre.num %></p>
                        </div>
                        <div class="desc">
                            <p><%= offre.type + ' - ' + offre.intitule%></p>
                            <p><%= offre.description%></p>
                        </div>
                        <div class="offer_button">
                            <button onclick="openCandidatures(this)">Voir les candidatures</button>
                            <button onclick="modifOffre(this)">Modifier l'offre</button>
                            <!-- <a href="recruteur_modif_offre"><button>Modifier</button></a> -->
                        </div>
                         
                    </div>
                    <% }) %>
                </div>
                <div id="fiches">
                    <div id="label">
                        <p>Liste des fiches de poste</p>
                    </div>
                    <% fiches.forEach((fiche)=> { %>
                    <div id="off">
                        <div class="entreprise">
                            <h1><%=fiche.organisation%></h1>
                            <p><%= fiche.intitule%></p>
                            <p>Id fiche : <%= fiche.id_fiche%></p>
                        </div>
                        <div class="desc">
                            <p>Type de métier : <%=fiche.type%></p>
                            <p>Statut du poste : <%=fiche.statut%></p>
                            <p>Responsable : <%=fiche.resp_hierarchique%></p>
                            <p>Rythme : <%=fiche.rythme_travail%></p>
                            <p>Teletravail : <%=fiche.teletravail%></p>
                            <p>Salaire : <%=fiche.salaire_min%> - <%=fiche.salaire_max%></p>
                            <p>Description : <%=fiche.description%></p>
                        </div>
                        <div class="offer_button">
                            <button onclick="modifFiche(this)">Modifier</button>
                            <button onclick="SupprFiche(this)">Supprimer</button>
                        </div>
                            
                    </div>
                    <% }) %>
                </div>
            </div>
        </div>

        <script>
            function openCandidatures(button) {
                var offreDiv = button.closest('#off');
                var idCandidatureElement = offreDiv.querySelector('.entreprise > p:last-child');
                var idCandidatureText = idCandidatureElement.textContent.trim();
                var num_offre = idCandidatureText.split("Numéro de l'offre : ")[1];
                // console.log(`/recruteur/voir-candidatures/${num_offre}`);
                window.location.href = `/recruteur/voir-candidatures/${num_offre}`;
            };

            function modifOffre(button) {
                var offreDiv = button.closest('#off');
                var idCandidatureElement = offreDiv.querySelector('.entreprise > p:last-child');
                var idCandidatureText = idCandidatureElement.textContent.trim();
                var num_offre = idCandidatureText.split("Numéro de l'offre : ")[1];
                window.location.href = `/recruteur/modif-offre/${num_offre}`;
            };

            function modifFiche(button) {
                var offreDiv = button.closest('#off');
                var idFicheElement = offreDiv.querySelector('.entreprise > p:last-child');
                var idFicheText = idFicheElement.textContent.trim();
                var id_fiche = idFicheText.split("Id fiche : ")[1];
                window.location.href = `/recruteur/modif-fiche/${id_fiche}`;
            };

        </script>
    </body>
</html>